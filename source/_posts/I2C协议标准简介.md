---
title: I2C协议标准简介
date: 2019-08-06 19:49:57
tags: 电子
---

### I2C总线概念

I2C总线是由一根SCL和一根SDA组成,每根总线都接到一个上拉电阻,所以总线空闲状态下都为高电平.所有的器件都并联在总线上,所以只要当其中一个器件输出低电平,总线就会表现为低电平.

同一个总线上,允许存在一个或多个主机,总线通常由主机控制,当有两个以上主机同时尝试控制总线,就会执行仲裁,赢得仲裁的主机,将获得总线的控制权.

![](https://yaozhijin.coding.net/p/img/git/raw/master/2019_08_06_19_51_24.png)

|术语|描述|
|---|---|
|发送器|发送数据到总线的器件 |
|接收器|从总线接收数据的器件 |
|主机|初始化发送 产生时钟信号和终止发送的器件|
|从机|被主机寻址的器件 |
|多主机|同时有多于一个主机尝试控制总线 但不破坏报文|
|仲裁|是一个在有多个主机同时尝试控制总线 但只允许其中一个控制总线并使报文不被破坏 的过程|
|同步|两个或多个器件同步时钟信号的过程|

> 注意: 发送器不等于主机,接收器也不等于从机.发送器和接收器仅由数据传送的方向决定

### 数据传输

#### 起始条件和停止条件

起始条件: 当SCL线高电平时, SDA线由高电平向低电平切换,开始数据传输.
停止条件: 当SCL线低电平时,SDA线由低电平向高电平切换,停止数据传输.

![](https://yaozhijin.coding.net/p/img/git/raw/master/2019_08_06_19_52_02.png)

#### 数据有效性

SDA线上的数据必须在时钟的高电平周期保持稳定,在SCL的低电平周期,才允许发生改变.

![](https://yaozhijin.coding.net/p/img/git/raw/master/2019_08_06_19_52_18.png)

#### 字节格式

发送到SDA上的每个字节必须是8位,每次传输可以发送的字节数量不受限制,每个字节后必须跟一个响应位,首先传输的是数据的高位.

#### 响应

数据传输必须带响应,相关的响应时钟脉冲由主机产生,在响应的时钟脉冲期间,发送器释放 SDA 线.在响应的时钟脉冲期间,接收器必须将SDA线拉低,使它在这个时钟脉冲的高电平期间保持稳定的低电平.

在数据传输过程中,如果从机要完成一些功能后(比如执行一个内部中断程序),才能发送或接收下一个字节,可以主动将SCL线拉低,迫使主机进入等待状态,当从机准备好之后,即可释放SCL线,数据传输继续.

![](https://yaozhijin.coding.net/p/img/git/raw/master/2019_08_06_19_52_48.png)

### 仲裁和时钟同步

主机只能在总线空闲的时侯启动传输,两个或多个主机可能在起始条件的小持续时间 tHD;STA内产生一个起始条件.这样,多个主机就要执行仲裁,赢得仲裁的主机,将获得总线的控制权.

多个主机的时钟频率可能会不同,这种情况下是没有办法执行仲裁的,所以在仲裁的同时需要进行时钟同步.

#### 时钟同步

所有主机在SCL线上产生它们自己的时钟来传输I2C总线上的报文 数据只在时钟的高电平周期有效.因此,需要一个确定的时钟进行逐位仲裁.

时钟同步通过线与连接 I2C 接口到 SCL 线来执行,这就是说 SCL 线的高到低切换会使器件开始数它们的低电平周期,而且一旦器件的时钟变低电平,它会使 SCL 线保持这种状态直到到达时钟的高电平.但是如果另一个时钟仍处于低电平周期,这个时钟的低到高切换不会改变 SCL 线的状态,因此 SCL 线被有长低电平周期的器件保持低电平,此时低电平周期短的器件会进入高电平的等待状态.

当所有有关的器件数完了它们的低电平周期后,时钟线被释放并变成高电平,之后器件时钟和 SCL 线的状态没有差别,而且所有器件会开始数它们的高电平周期,首先完成高电平周期的器件会再次将 SCL 线拉低.

这样,产生的同步 SCL 时钟的低电平周期由低电平时钟周期长的器件决定,而高电平周期由高电平时钟周期短的器件决定.

![](https://yaozhijin.coding.net/p/img/git/raw/master/2019_08_06_19_53_07.png)
 
#### 仲裁

时钟同步后,当SCL位高电平时,仲裁在SDA线发生.当其他主机向SDA发送低电平时,发送高电平的主机将丢失仲裁,因为它发现总线上的电平与自己的电平不同.

![](https://yaozhijin.coding.net/p/img/git/raw/master/2019_08_06_19_53_23.png)

如图所示,两个主机DATA1和DATA2同时尝试控制总线,在第一和第二个时钟周期,两个主机向SDA发送了相同的位数据,但是在第三个时钟周期,DATA1发送了高电平,DATA2发送了低电平.但是因为此时总线上表现出来的为低电平,所以发送高电平的主机DATA1丢失了仲裁.从图上可以看到,这种仲裁方式并不会破坏数据.

> 更多详细信息请查看I2C协议标准官方文档